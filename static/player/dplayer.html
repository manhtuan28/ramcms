<!DOCTYPE html>
<html>
<head>
	<title>dplayer播放器</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=11" />
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
	<style type="text/css">
	html,body{width:100%;height:100%; padding:0; margin:0;}
	#playerCnt{width:100%;height:100%;}
	</style>
	<link rel="stylesheet" href="/static/player/dplayer/DPlayer.min.css">
	<script type="text/javascript" src="/static/player/dplayer/flv.min.js"></script>
	<script type="text/javascript" src="/static/player/dplayer/hls.min.js"></script>
	<script type="text/javascript" src="/static/player/dplayer/dash.all.min.js"></script>
	<script type="text/javascript" src="/static/player/dplayer/webtorrent.min.js"></script>
	<script type="text/javascript" src="/static/player/dplayer/DPlayer.min.js"></script>
</head>
<body marginwidth="0" marginheight="0">
<div id="playerCnt"></div>
<script type="text/javascript">
    var type = 'normal';
    var live = false;
    if (parent.MacPlayer.PlayUrl.indexOf('.m3u8') > -1) {
        type = 'hls';
        live = true;
    } else if (parent.MacPlayer.PlayUrl.indexOf('magnet:') > -1) {
        type = 'webtorrent';
    } else if (parent.MacPlayer.PlayUrl.indexOf('.flv') > -1) {
        type = 'flv';
    } else if (parent.MacPlayer.PlayUrl.indexOf('.mpd') > -1) {
        type = 'dash';
    }

    var dp = new DPlayer({
        container: document.getElementById('playerCnt'),
        autoplay: true,
        screenshot: true,
        lang: 'en',
        airplay: true,
        preload: 'auto',
        video: {
            url: parent.MacPlayer.PlayUrl,
            live: live,
            type: type
        },
        contextmenu: []
    });

    var playbackData = []; // Array to store playback data

    dp.on('play', function() {
        try {
            var currentTime = dp.video.currentTime;
            playbackData.push({ event: 'play', time: currentTime });
            console.log('Play event recorded at', currentTime);
        } catch (e) {
            console.error('Error recording play event:', e);
        }
    });

    dp.on('pause', function() {
        try {
            var currentTime = dp.video.currentTime;
            playbackData.push({ event: 'pause', time: currentTime });
            console.log('Pause event recorded at', currentTime);
        } catch (e) {
            console.error('Error recording pause event:', e);
        }
    });

    dp.on('seeked', function() {
        try {
            var currentTime = dp.video.currentTime;
            playbackData.push({ event: 'seeked', time: currentTime });
            console.log('Seeked event recorded at', currentTime);
        } catch (e) {
            console.error('Error recording seeked event:', e);
        }
    });

    dp.on('ended', function() {
        try {
            var currentTime = dp.video.currentTime;
            playbackData.push({ event: 'ended', time: currentTime });
            console.log('Ended event recorded at', currentTime);
            if (parent.MacPlayer.PlayLinkNext != '') {
                top.location.href = parent.MacPlayer.PlayLinkNext;
            }
        } catch (e) {
            console.error('Error recording ended event:', e);
        }
    });

    // Function to save playback data
    function savePlaybackData() {
        try {
            localStorage.setItem('playbackData', JSON.stringify(playbackData));
            console.log('Playback data saved');
        } catch (e) {
            console.error('Error saving playback data:', e);
        }
    }

    // Call savePlaybackData when the user leaves the page or when video ends
    window.addEventListener('beforeunload', savePlaybackData);
</script>
</body>
</html>
